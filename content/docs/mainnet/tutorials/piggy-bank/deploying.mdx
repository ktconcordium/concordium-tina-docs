---
title: "Deploying the piggy bank smart contract"
---

(piggy-bank-deploying)=


This is the third [part of a tutorial](/docs/mainnet/tutorials/piggy-bank/index#piggy-bank) on smart contract
development.
So far you have written and tested a piggy bank smart contract in the [Rust] programming language.

This part focuses on how you can deploy your developed piggy bank smart contract to the Concordium testnet and interact with it.

## Preparation

Before you start, make sure you completed the previous parts of the tutorial and have a running testnet node that has caught up to the head of the blockchain and an account with some CCD setup.

## Building a Wasm module

You have already built a Wasm module from your piggy bank smart contract in a [previous part](/docs/mainnet/tutorials/piggy-bank/writing#cargo-concordium-build) of this tutorial.

Repeat this step since you might have done some changes to the smart contract code in [part 2](/docs/mainnet/tutorials/piggy-bank/testing#piggy-bank-testing) of this tutorial. Go to the folder where you saved your piggy bank smart contract and use `cargo concordium build` to create a Wasm module.

```console
$cargo concordium build --out piggy_bank_part2.wasm.v1
```

<Callout
  body={<>
This command outputs the module `piggy_bank_part2.wasm.v1` to the project's root folder.
  </>}
  variant="info"
/>


<Callout
  body={<>
When you use the above command *without* the `--out` flag, you can find the module in the folder `./target/concordium/wasm32-unknown-unknown/release/`.
Use the Wasm module file suffixed with `v1` when deploying to the chain. The `piggy_bank_part2.wasm` file (without the `v1` suffix) is not the `v0` module, but rather the raw Wasm module produced by cargo.
The `v1` suffixed module has been stripped for debugging information, which makes it significantly smaller.
  </>}
  variant="info"
/>


The `piggy_bank_part2.wasm.v1` file can be deployed to the Concordium chain. Transfer the `piggy_bank_part2.wasm.v1` file to the place where you are running your `concordium-client` tool. Navigate to the folder as well.

## Deploying a module

You are now set up to deploy the piggy bank module to the testnet chain. Give the module the name `piggy_bank_part2_module` so it can be referenced in this tutorial.

<Callout
  body={<>
Remember to adjust the following commands when you are running your `concordium-client` tool locally and want to connect to your node on the server. You can look up the different options on how to connect the `concordium-client` tool to your testnet node [here](/docs/shared/setup-env#interact-with-your-contract).
  </>}
  variant="info"
/>


<Callout
  body={<>
Names are only stored locally in the `concordium client` configuration.
They are not visible to others on the chain. This is the case for all contracts, modules, and account names/aliases.
  </>}
  variant="info"
/>


```console
$./concordium-client module deploy piggy_bank_part2.wasm.v1 --sender <account-name> --name piggy_bank_part2_module --grpc-port 20001
```

If everything works correctly the output has a green line with your module reference.

```console
Module successfully deployed with reference: <module-reference>.
Module reference <module-reference> was successfully named 'piggy_bank_part2_module'.
```

You can find additional information about deploying a module in this [guide](/docs/mainnet/docs/smart-contracts/guides/deploy-module#deploy-module).

<Callout
  body={<>
Deploying the piggy bank module will fail with an error message if a module with the exact same hash (the \<module-reference>) has already been deployed.
If you compile the same contract on different systems or versions of rustc, then their hashes will often differ.
You can continue this tutorial by using the module reference printed in the error message instead of the name `` `piggy_bank_part2_module` ``.
  </>}
  variant="info"
/>


```console
Error: Module deployment failed:
Module <module-reference> already exists.
```

![](./images/pb_tutorial_20.png)console
$./concordium-client contract init piggy_bank_part2_module --sender <account-name> --contract PiggyBank --name piggy_bank_part2_instance --energy 1500 --grpc-port 20001
```

<Callout
  body={<>
1500 is enough energy to initialize the piggy bank smart contract but you
might need more energy for larger smart contracts. The `--energy` parameter sets the maximum allowed
energy to be used. You only pay for the actual energy used.
  </>}
  variant="info"
/>


If everything works correctly the output has a green line with your smart contract instance index.

```console
Contract successfully initialized with address: {"index":<smart-contract-instance-index>,"subindex":0}
Contract address {"index":<smart-contract-instance-index>,"subindex":0} was successfully named 'piggy_bank_part2_instance'.
```

![](./images/pb_tutorial_22.png)console
$./concordium-client contract update piggy_bank_part2_instance --entrypoint insert --energy 1000 --sender <account-name> --amount 1 --grpc-port 20001
```

If everything works correctly the output has a green line as follows:

```console
Successfully updated contract instance {"index":<smart-contract-instance-index>,"subindex":0} ('piggy_bank_part2_instance') using the function 'insert'.
```

![](./images/pb_tutorial_23.png)console
$./concordium-client contract invoke piggy_bank_part2_instance --entrypoint view --energy 1000 --grpc-port 20001
```

If everything works correctly the output has a green line as follows:

```console
Invocation resulted in success:
- Energy used: 510 NRG
- Return value (raw):
[0,64,66,15,0,0,0,0,0]
.
```

![](./images/pb_tutorial_24.png)console
$./concordium-client contract update piggy_bank_part2_instance --entrypoint smash --sender <account-name> --energy 2000 --grpc-port 20001
```

If everything works correctly the output has a green line as follows:

```console
Successfully updated contract instance {"index":<smart-contract-instance-index>,"subindex":0} ('piggy_bank_part2_instance') using the function 'smash'.
```

![](./images/pb_tutorial_25.png)console
Error: Updating contract instance failed:
'smash' in 'PiggyBank' at {"index":<smart-contract-instance-index>,"subindex":0} failed with code -2147483636.
```

![](./images/pb_tutorial_21.png)console
Error: Updating contract instance failed:
'smash' in 'PiggyBank' at {"index":<smart-contract-instance-index>,"subindex":0} failed with code -1.
```

![](./images/pb_tutorial_27.png)

<Callout
  body={<>
You can find the meaning of the piggy bank error codes in this [section](/docs/mainnet/tutorials/piggy-bank/testing#piggy-bank-smash-error).
This error was thrown by the smart contract. The error codes start from `-1` and go downwards.
`-1` is the first error code and corresponds to `NotOwner`.
In contrast, errors from the `concordium-std` crate start from `i32::MIN` and go upwards.
  </>}
  variant="info"
/>


Congratulations. You have completed the whole piggy bank tutorial.

[rust]: https://www.rust-lang.org/